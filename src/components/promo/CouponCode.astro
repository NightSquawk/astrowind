---
interface Props {
	code: string;
	class?: string;
}

const { code, class: className = '' } = Astro.props;
---

<div class={`my-6 ${className}`}>
	<div class="text-sm font-medium text-muted dark:text-slate-400 mb-2">Coupon Code:</div>
	<div class="flex items-center justify-between gap-3 bg-slate-50 dark:bg-slate-800 px-6 py-4 rounded-lg border-2 border-dashed border-primary" data-code={code}>
		<span class="font-mono text-xl md:text-2xl font-bold text-primary tracking-wider flex-1 text-center">
			{code}
		</span>
		<button 
			class="coupon-code-copy flex-shrink-0 p-2 rounded-md text-primary hover:bg-primary hover:text-white transition-all duration-200 active:scale-95" 
			aria-label="Copy coupon code"
		>
			<svg width="20" height="20" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5">
				<path d="M5.5 3.5H3.5C2.67 3.5 2 4.17 2 5V12.5C2 13.33 2.67 14 3.5 14H11C11.83 14 12.5 13.33 12.5 12.5V10.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
				<path d="M5.5 3.5C5.5 2.67 6.17 2 7 2H10.5L14 5.5V9C14 9.83 13.33 10.5 12.5 10.5H7C6.17 10.5 5.5 9.83 5.5 9V3.5Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
			</svg>
		</button>
	</div>
	<div class="coupon-code-feedback text-center text-sm font-semibold text-primary mt-2 opacity-0 transform -translate-y-2 transition-all duration-300 h-0" aria-live="polite"></div>
</div>

<script>
	// Find all coupon code elements and set up copy functionality
	document.querySelectorAll('[data-code]').forEach((codeElement) => {
		const couponCode = codeElement.getAttribute('data-code');
		if (!couponCode) return;
		
		const copyButton = codeElement.querySelector('.coupon-code-copy');
		const feedback = codeElement.closest('.coupon-code-wrapper')?.querySelector('.coupon-code-feedback');
		
		if (copyButton) {
			copyButton.addEventListener('click', async () => {
				try {
					await navigator.clipboard.writeText(couponCode);
					if (feedback) {
						feedback.textContent = 'Copied!';
						feedback.classList.remove('opacity-0', '-translate-y-2', 'h-0');
						feedback.classList.add('opacity-100', 'translate-y-0', 'h-auto');
						setTimeout(() => {
							feedback.classList.remove('opacity-100', 'translate-y-0', 'h-auto');
							feedback.classList.add('opacity-0', '-translate-y-2', 'h-0');
							setTimeout(() => feedback.textContent = '', 300);
						}, 2000);
					}
					
					// Track coupon copy event
					import('~/scripts/promo-analytics').then(({ trackCouponCopied }) => {
						trackCouponCopied({
							couponCode: couponCode,
							couponSlug: window.location.pathname.split('/').filter(Boolean).pop() || '',
						});
					}).catch(() => {
						// Fallback to direct gtag if module fails
						if (window.gtag) {
							window.gtag('event', 'coupon_copied', {
								coupon_code: couponCode,
								page_location: window.location.href,
							});
						}
					});
				} catch (err) {
					console.warn('Failed to copy coupon code:', err);
				}
			});
		}
	});
</script>

